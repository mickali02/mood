<!-- ui/html/profile.tmpl -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lora&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body class="profile-page-body">

    <div class="profile-outer-container">
        <h1>User Profile</h1>

        {{with .Flash}}
            <div class="flash-message success">
                <p>{{.}}</p>
                <button type="button" class="flash-close-btn" aria-label="Close message">√ó</button>
            </div>
        {{end}}

        <div class="profile-content-area">
            {{if eq .ProfileCurrentPage 1}}
            <div class="profile-page-content profile-page-1">
                <div class="profile-row">
                    <section class="profile-section profile-section-half">
                        <h2>Account Information</h2>
                        <form action="/user/profile/update" method="POST" novalidate>
                            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                            <div class="form-group">
                                <label for="name">Name:</label>
                                <input type="text" id="name" name="name" value="{{index .FormData "name"}}" required class="{{if index .FormErrors "name"}}invalid{{end}}">
                                {{with index .FormErrors "name"}}<span class="error-message">{{.}}</span>{{end}}
                            </div>
                            <div class="form-group">
                                <label for="email">Email:</label>
                                <input type="email" id="email" name="email" value="{{index .FormData "email"}}" required class="{{if index .FormErrors "email"}}invalid{{end}}">
                                {{with index .FormErrors "email"}}<span class="error-message">{{.}}</span>{{end}}
                            </div>
                            <div class="button-group">
                                <button type="submit" class="btn">Save Changes</button>
                            </div>
                        </form>
                    </section>

                    <section class="profile-section profile-section-half password-change-section">
                        <h2>üîë Change Password</h2>
                        <form action="/user/profile/password" method="POST" novalidate>
                            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                            <div class="form-group">
                                <label for="current_password">Current Password:</label>
                                <input type="password" id="current_password" name="current_password" required class="{{if index .FormErrors "current_password"}}invalid{{end}}">
                                {{with index .FormErrors "current_password"}}<span class="error-message">{{.}}</span>{{end}}
                            </div>
                            <div class="form-group">
                                <label for="new_password">New Password:</label>
                                <input type="password" id="new_password" name="new_password" required class="{{if index .FormErrors "new_password"}}invalid{{end}}">
                                {{with index .FormErrors "new_password"}}<span class="error-message">{{.}}</span>{{end}}
                                 <small class="form-hint">Minimum 8 characters.</small>
                            </div>
                            <div class="form-group">
                                <label for="confirm_password">Confirm New Password:</label>
                                <input type="password" id="confirm_password" name="confirm_password" required class="{{if index .FormErrors "confirm_password"}}invalid{{end}}">
                                {{with index .FormErrors "confirm_password"}}<span class="error-message">{{.}}</span>{{end}}
                            </div>
                            <div class="button-group">
                                <button type="submit" class="btn">Update Password</button>
                            </div>
                        </form>
                    </section>
                </div>
            </div>
            {{else if eq .ProfileCurrentPage 2}}
            <div class="profile-page-content profile-page-2"> <!-- Make sure profile-page-2 class is here -->
                <div class="profile-row">
                    <section class="profile-section profile-section-half">
                        <h2>üßº Reset All Entries</h2>
                        <p>Resetting your entries is useful if you want a fresh start with Feel Flow. All previously logged moods, statistics, and associated data will be removed. This process is irreversible. Your account itself will remain active.</p>
                        <form action="/user/profile/reset-entries" method="POST" onsubmit="return confirm('Are you absolutely sure you want to delete ALL your mood entries? This cannot be undone.');">
                            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                            <div class="button-group profile-actions">
                                <button type="submit" class="btn reset-btn">Confirm Reset Entries</button>
                            </div>
                        </form>
                    </section>

                    <section class="profile-section profile-section-half">
                        <h2>‚ö†Ô∏è Delete Account</h2>
                        <p>If you no longer wish to use Feel Flow, you can permanently delete your account here.</p>
                        <p class="profile-warning">Warning: This action is permanent and cannot be undone! All your account data, including mood entries, will be permanently erased. Once deleted, your username, email, password, and all mood data will be irretrievably lost. If you're sure, proceed below.</p>
                        <form action="/user/profile/delete-account" method="POST" onsubmit="return confirm('DANGER ZONE! Are you absolutely sure you want to PERMANENTLY DELETE your account and all associated data? This cannot be undone.');">
                            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                            <div class="button-group profile-actions">
                                <button type="submit" class="btn delete-btn">Confirm Account Deletion</button>
                            </div>
                        </form>
                    </section>
                </div>
            </div>
            {{end}}
        </div>

        <!-- **** MODIFIED FOOTER STRUCTURE **** -->
        <div class="profile-footer-controls">
            <div class="profile-footer-back-link"> <!-- Wrapper for back link -->
                <a href="/dashboard" class="back-link">‚Üê Back to Dashboard</a>
            </div>

            {{if gt .ProfileTotalPages 1}}
            <nav class="pagination profile-pagination" aria-label="Profile Settings Pagination">
                <ul>
                    {{if eq .ProfileCurrentPage 1}}
                        <li class="disabled"><span>< Previous</span></li>
                    {{else}}
                        {{ $prevPage := sub .ProfileCurrentPage 1 }}
                        <li><a href="/user/profile?page={{$prevPage}}">< Previous</a></li>
                    {{end}}

                    <li>
                        <span>Page {{.ProfileCurrentPage}} of {{.ProfileTotalPages}}</span>
                    </li>

                    {{if eq .ProfileCurrentPage .ProfileTotalPages}}
                         <li class="disabled"><span>Next ></span></li>
                    {{else}}
                         {{ $nextPage := add .ProfileCurrentPage 1 }}
                         <li><a href="/user/profile?page={{$nextPage}}">Next ></a></li>
                    {{end}}
                </ul>
            </nav>
            {{else}}
            <div class="pagination-placeholder"></div> <!-- Placeholder to help with alignment if no pagination -->
            {{end}}

            <div class="profile-footer-spacer"></div>
        </div>

    </div>
    <script src="/static/js/dashboard.js" defer></script>
</body>
</html>