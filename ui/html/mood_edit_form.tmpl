<!-- ui/html/mood_edit_form.tmpl -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>{{.Title}}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    <!-- Link to the main CSS file where modal styles are -->
    <link rel="stylesheet" href="/static/styles.css">
    <!-- No inline style block needed here -->
  </head>
  <body class="mood-form-page"> <!-- Reuse class for similar styling -->

    <div class="form-container">
      <h1>{{.HeaderText}}</h1>

            <!-- IMPORTANT: Form action includes the mood ID -->
      <form action="/mood/edit/{{.Mood.ID}}" method="POST" novalidate id="mood-entry-form"> <!-- Reuse JS ID -->

        <!-- === MOVED: Emotion Selector First === -->
        <div class="form-group">
          <label>How are you feeling?</label>
          {{with index .FormErrors "emotion"}} <span class="error-message emotion-group-error">{{.}}</span> {{end}}
          {{with index .FormErrors "emoji"}} <span class="error-message emotion-group-error">{{.}}</span> {{end}}
          {{with index .FormErrors "color"}} <span class="error-message emotion-group-error">{{.}}</span> {{end}}

          <div class="emotion-selector {{if or (index .FormErrors "emotion") (index .FormErrors "emoji") (index .FormErrors "color")}}has-error{{end}}" id="emotion-options-container">
              {{range .DefaultEmotions}}
                <div class="emotion-option-wrapper">
                    {{ $currentChoice := "" }}
                    {{ with index $.FormData "emotion_choice" }}{{ $currentChoice = . }}{{ else }}{{ $currentChoice = $.Mood.Emotion }}{{ end }}

                    <input type="radio" id="emotion-{{.Name}}" name="emotion_choice" value="{{.Name}}" data-emoji="{{.Emoji}}" data-color="{{.Color}}" class="hidden-radio default-emotion-radio" {{if eq $currentChoice .Name}}checked{{end}}>
                    <label for="emotion-{{.Name}}" class="emotion-option">
                        <span class="emotion-option-emoji">{{.Emoji}}</span>
                        <span class="emotion-option-name">{{.Name}}</span>
                    </label>
                </div>
              {{end}}
              <!-- "Other" Option -->
               {{ $isOtherPreselected := false }}
               {{ with index .FormData "emotion_choice" }} {{ if eq . "other" }}{{ $isOtherPreselected = true }}{{ end }}
               {{ else }}
                   {{ $isDefault := false }}
                   {{ range $.DefaultEmotions }}{{ if eq $.Mood.Emotion .Name }}{{ $isDefault = true }}{{ end }}{{ end }}
                   {{ if not $isDefault }}{{ $isOtherPreselected = true }}{{ end }}
               {{ end }}
               <div class="emotion-option-wrapper">
                   <input type="radio" id="emotion-other" name="emotion_choice" value="other" class="hidden-radio other-emotion-radio" {{if $isOtherPreselected}}checked{{end}}>
                   <label for="emotion-other" class="emotion-option other-option">
                       <span class="emotion-option-emoji">â•</span>
                       <span class="emotion-option-name">Other...</span>
                   </label>
               </div>
          </div>
        </div>
        <!-- === END MOVED === -->

        <!-- Title Field Second -->
        <div class="form-group">
          <label for="title">Title:</label>
          <input type="text" id="title" name="title" value="{{with index .FormData "title"}}{{.}}{{else}}{{.Mood.Title}}{{end}}" required class="{{if index .FormErrors "title"}}invalid{{end}}" placeholder="Update title...">
          {{with index .FormErrors "title"}} <span class="error-message">{{.}}</span> {{end}}
        </div>

        <!-- Content Field Third -->
        <div class="form-group">
          <label for="content">Details:</label>
          <textarea id="content" name="content" required class="{{if index .FormErrors "content"}}invalid{{end}}" placeholder="Update details...">{{with index .FormData "content"}}{{.}}{{else}}{{.Mood.Content | html}}{{end}}</textarea>
          {{with index .FormErrors "content"}} <span class="error-message">{{.}}</span> {{end}}
        </div>

        <!-- Hidden fields (Order doesn't matter here) -->
        <input type="hidden" name="emotion" id="final_emotion_name" value="{{with index .FormData "emotion"}}{{.}}{{else}}{{.Mood.Emotion}}{{end}}">
        <input type="hidden" name="emoji" id="final_emotion_emoji" value="{{with index .FormData "emoji"}}{{.}}{{else}}{{.Mood.Emoji}}{{end}}">
        <input type="hidden" name="color" id="final_emotion_color" value="{{with index .FormData "color"}}{{.}}{{else}}{{.Mood.Color}}{{end}}">


        <!-- Buttons (Remain last) -->
        <div class="button-group">
          <button type="submit" class="btn dashboard-add-btn">Update Mood</button>
          <a href="/dashboard" class="btn cancel-btn">Cancel</a>
        </div>
      </form>
    </div>

    <!-- Custom Emotion Modal (Identical structure to mood_form.tmpl) -->
    <div id="custom-emotion-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-close" id="modal-close-button">Ã—</span>
          <h2>Define Custom Emotion</h2>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="custom_emotion_name">Emotion Name:</label>
                <input type="text" id="custom_emotion_name" placeholder="e.g., Tired, Inspired, Grateful" maxlength="50">
                 <span class="error-message" id="custom-name-error"></span>
            </div>
             <div class="form-group">
                <label for="custom_emotion_emoji">Emoji:</label>
                <input type="text" id="custom_emotion_emoji" placeholder="Click a suggestion or type/paste" maxlength="5">
                 <span class="error-message" id="custom-emoji-error"></span>
                 <div class="emoji-suggestions">
                    <button type="button" class="emoji-suggestion-btn">ğŸ˜Š</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜„</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜‚</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜</button> <button type="button" class="emoji-suggestion-btn">ğŸ¤©</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜˜</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜‰</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜Œ</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜¢</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜­</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜ </button> <button type="button" class="emoji-suggestion-btn">ğŸ˜¡</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜Ÿ</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜´</button> <button type="button" class="emoji-suggestion-btn">ğŸ¤”</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜</button> <button type="button" class="emoji-suggestion-btn">ğŸ¤</button> <button type="button" class="emoji-suggestion-btn">ğŸ¥³</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜</button> <button type="button" class="emoji-suggestion-btn">ğŸ¤¢</button> <button type="button" class="emoji-suggestion-btn">ğŸ¤¯</button> <button type="button" class="emoji-suggestion-btn">ğŸ¥º</button> <button type="button" class="emoji-suggestion-btn">ğŸ¥¶</button> <button type="button" class="emoji-suggestion-btn">ğŸ˜‡</button>
                 </div>
            </div>
             <div class="form-group">
                <label for="custom_emotion_color">Color:</label>
                <input type="color" id="custom_emotion_color" value="#cccccc">
                 <span class="error-message" id="custom-color-error"></span>
            </div>
        </div>
         <div class="modal-footer button-group">
             <button type="button" id="modal-cancel-button" class="btn cancel-btn">Cancel</button>
             <button type="button" id="modal-save-button" class="btn">Save Custom</button>
         </div>
      </div>
    </div>

    <!-- Load the SAME JavaScript file -->
    <script src="/static/js/mood_form.js"></script>

  </body>
</html>